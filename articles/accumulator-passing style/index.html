<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script type="text/javascript">
    if (location.href.endsWith("index.html")) {
      location.href = location.href.substring(0, location.href.length - "index.html".length);
    }
  </script>
  
    <title>
      Accumulator-passing style
    </title>
    

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/default.min.css"
          media="(prefers-color-scheme: light)">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/dracula.min.css"
          media="(prefers-color-scheme: dark)">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/default.min.css"
          media="(prefers-color-scheme: no-preference)">
        <style type="text/css">
          body {
            width: 60%;
            margin: 0 auto;
            padding: 2em;
            font-family: 'Segoe UI',
              "Microsoft Yahei Light",
              "San Francisco",
              "Ping Fang SC",
              "Roboto",
              "Noto Sans CJK",
              Tahoma, Geneva, Verdana, sans-serif;
          }

          p>img {
            margin: 0 auto;
            display: block;
            max-width: 80%;
          }

          span.field {
            display: inline-block;
            font-weight: bolder;
            font-size: smaller;
          }

          pre {
            max-width: 90%;
            overflow-x: scroll;
            padding: 1em;
            border-radius: 5px;
          }

          a {
            text-decoration: none;
            color: cornflowerblue;
          }

          a:visited {
            color: cornflowerblue;
          }

          a:hover {
            color: darkgray;
          }

          a.disabled-link {
            color: lightcoral;
            text-decoration: line-through;
          }

          nav,
          nav ul {
            display: inline-block;
          }

          .tags ul,
          footer ul {
            padding: 0;
            display: inline;
          }

          header h1 {
            display: inline-block;
            min-width: 320px;
            max-width: 50%;
            width: 50%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin: auto;
          }

          @media screen and (max-width: 1200px) {
            body {
              width: 90%;
              max-width: 720px;
              padding: 0;
              margin: 1em auto;
            }

            header h1 {
              max-width: 90%;
              width: 90%;
            }
          }

          nav li,
          .tags li,
          footer li {
            display: inline;
            border-right: 1px solid darkgray;
            padding: 0 1em;
          }

          nav li:last-child,
          .tags li:last-child,
          footer li:last-child {
            border: none;
          }

          .post-list h3 {
            margin: 0.3em 0;
          }

          blockquote {
            margin: 0.5em;
            border: 1px dotted darkgrey;
            border-radius: 0.5em;
            padding: 0 1em;
          }

          div.image-description {
            text-align: center;
            color: gray;
            font-size: smaller;
          }

          @media (prefers-color-scheme: dark) {
            body {
              background-color: #090810;
              color: floralwhite;
              opacity: 0.83;
            }

            pre {
              background-color: #282a36;
            }
          }
        </style>
        <script>
          var _hmt = _hmt || [];
          (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?d06710df49879016f95c45042560225e";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
          })();
          </script>
</head>

<body>

  <header>
    
      <h1 title="Accumulator-passing style">
        Accumulator-passing style
      </h1>
      
          <nav>
            <ul>
              <li><a href="/">Home</a></li>
              <li><a href="/articles">Articles</a></li>
              <li><a href="/about">About</a></li>
            </ul>
          </nav>
          <hr>
          <span class="field">Author: <a href="/about">KimmyLeo</a></span>
          
  </header>
  <article>
    <p>åœ¨ä½ æ‰€éœ€è¦çŸ¥é“çš„å…³äºå‡½æ•°çš„ä¸€åˆ‡å¼€ç¯‡æˆ‘å°±æåˆ°äº†ä¸€ç§æŠŠ fibonacci å‡½æ•°çš„æ ‘çŠ¶é€’å½’æ”¹æˆè¿­ä»£å¼å°¾é€’å½’å½¢å¼çš„æ–¹æ³•ã€‚è¿™ç§æ–¹æ³•ä¸€ç›´ä»¥æ¥éƒ½æ˜¯äº†è§£å‡½æ•°å¼ç¼–ç¨‹å…¥é—¨å¿…é¡»è¦äº†è§£çš„å†…å®¹ï¼Œä½†ç©·å°½äº†æˆ‘çš„è¯­è¨€èƒ½åŠ›ä¹Ÿæ²¡åŠæ³•ç»™ä»–ä¸€ä¸ªåˆé€‚çš„åç§°ã€‚</p>
<p>ä»Šå¤©æ°å¥½åœ¨å¾®ä¿¡ç¾¤æŒ–åŸçš„æ—¶å€™çœ‹åˆ°äº†è¿™æ ·ä¸€ä¸ªæ¦‚å¿µï¼ŒAccumulator-passing styleï¼Œç¬é—´è±ç„¶å¼€æœ—ã€‚å°½ç®¡ä½¿ç”¨ Google æœç´¢äº†ä¸€ä¸‹å‘ç°è¿™ä¸ªè¯ä¹Ÿä¸æ˜¯é‚£ä¹ˆå¸¸è§ï¼Œé¦–é¡µä¹Ÿå°±åªæœ‰å‡ ä¸ªç›¸å…³çš„ç»“æœï¼Œä½†ç¡®å®èƒ½æŠŠè¿™ä¸ªæ¦‚å¿µç›¸å¯¹å‡†ç¡®åœ°æè¿°æ¸…æ¥šã€‚</p>
<p>é¡ºä¾¿æ ¹æ® Google æœç´¢ç»“æœæ‰¾åˆ°äº†å‡ ä¸ªæ›´åŠ ç®€å•çš„å®ç° accumulator-passing style çš„è¯´æ˜æ–‡æ¡£ã€‚è¿™é‡Œé€‰ä¸€ç¯‡çš„å†…å®¹æ‘˜å½•ä¸€ä¸‹ï¼Œé™„ä¸Šæˆ‘æ”¹è¿‡çš„å®ä¾‹ã€‚æ¯”èµ·åœ¨ä¹‹å‰çš„æ•™ç¨‹ä¸­ç»•æ¥ç»•å»é€šè¿‡å¾ªç¯è½¬å†™çš„æ–¹å¼å®ç°ï¼ˆæ€è·¯æ¥è‡ª Alexander Stepanov çš„ Elements of Programmingï¼‰è¦æ›´åŠ ç®€å•ç›´æ¥ã€‚</p>
<h2 id="å°¾é€’å½’">å°¾é€’å½’</h2>
<p>é¦–å…ˆè¦è§£é‡Šçš„ä¸€ä¸ªæ¦‚å¿µæ˜¯<strong>å°¾é€’å½’</strong>ã€‚ï¼ˆè¿™ä¹Ÿæ˜¯ä¹‹å‰æ•™ç¨‹ä¸­é—æ¼çš„å†…å®¹ ğŸ˜…ï¼‰</p>
<p>å°¾é€’å½’ï¼ˆtail-recursionï¼‰æ˜¯é€’å½’çš„ä¸€ç§ç‰¹æ®Šå½¢å¼ã€‚å³å‡½æ•°çš„æœ€åä¸€ä¸ªåŠ¨ä½œæ˜¯å¯¹è‡ªèº«çš„å°¾è°ƒç”¨ï¼ˆtail callï¼‰ã€‚</p>
<p>ä¸€ä¸ªå°¾è°ƒç”¨æ˜¯æŒ‡å‡½æ•°çš„æœ€åä¸€ä¸ªåŠ¨ä½œæ˜¯è¿”å›ä¸€ä¸ªå‡½æ•°çš„è°ƒç”¨ç»“æœã€‚è¿™æ ·å¯ä»¥é€šè¿‡ç®€åŒ–å‡½æ•°æ ˆå¸§æ¥è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ï¼ˆtail call eliminationï¼Œå°¾è°ƒç”¨æ¶ˆé™¤ï¼‰ã€‚</p>
<p>æ¯”å¦‚ï¼š</p>
<pre><code class="language-js"><span class="hljs-keyword">function</span> <span class="hljs-title">fact1</span>(n) {
  if (n == 0) {
    <span class="hljs-keyword">return</span> <span class="hljs-type">1</span>;
  }
  <span class="hljs-keyword">return</span> n * fact1(n - <span class="hljs-number">1</span>);
}

<span class="hljs-keyword">function</span> <span class="hljs-title">fact2</span>(n, acc) {
  if (n == 0) {
    <span class="hljs-keyword">return</span> <span class="hljs-type">acc</span>;
  }
  <span class="hljs-keyword">return</span> fact2(n - <span class="hljs-number">1</span>, n * acc);
}
</code></pre>
<p>åœ¨ä¸Šé¢ä¸¤ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>fact1</code> æ˜¯å¸¸è§„çš„é€’å½’ï¼Œ<code>fact2</code> åˆ™æ˜¯å°¾é€’å½’çš„å½¢å¼ã€‚å› ä¸ºåœ¨ <code>fact1</code> ä¸­ï¼Œé™¤äº†å¯¹è‡ªèº«é€’å½’è°ƒç”¨ä»¥å¤–ï¼Œè¿˜éœ€è¦å†æ‹¿åˆ°ç»“æœè®¡ç®— <code>n * _</code>ã€‚è€Œ <code>fact2</code> ä¸­ï¼Œæœ€åçš„åŠ¨ä½œåˆ™åªæœ‰ç®€å•çš„å¯¹è‡ªèº«çš„é€’å½’è°ƒç”¨ï¼Œæ‰€æœ‰çš„å‚æ•°ä¼ é€’ä¹Ÿæ˜¯åœ¨è°ƒç”¨ä¹‹å‰å°±éœ€è¦æ±‚å€¼å®Œæˆçš„ã€‚</p>
<h2 id="æ”¹å†™æˆ-accumulator-passing-style-çš„æ­¥éª¤">æ”¹å†™æˆ accumulator-passing style çš„æ­¥éª¤</h2>
<p>åªéœ€è¦ç®€å•çš„ 4 æ­¥ï¼Œå°±å¯ä»¥è½»æ¾çš„æŠŠå¤§éƒ¨åˆ†é€’å½’æ”¹å†™æˆ accumulator styleã€‚è¿™é‡Œä»¥ factorialï¼ˆé˜¶ä¹˜ï¼‰å‡½æ•°ä¸ºä¾‹ã€‚</p>
<pre><code class="language-js"><span class="hljs-keyword">function</span> <span class="hljs-title">fact</span>(n) {
  if (n == 0) {
    <span class="hljs-keyword">return</span> <span class="hljs-type">1</span>;
  }
  <span class="hljs-keyword">return</span> n * fact(n - <span class="hljs-number">1</span>);
}
</code></pre>
<p><strong>ç¬¬ä¸€æ­¥</strong>ï¼Œå¼•å…¥ accumulator ä½œä¸ºå‚æ•°ã€‚</p>
<pre><code class="language-js"><span class="hljs-keyword">function</span> fact<span class="hljs-constructor">Acc(<span class="hljs-params">n</span>, <span class="hljs-params">acc</span>)</span> {
  ...
</code></pre>
<p>å› ä¸º accumulator åœ¨æ•´ä¸ªé€’å½’è¿‡ç¨‹ä¸­ç”¨äºç´¯è®¡é€’å½’çš„ç»“ç®—ç»“æœå’Œé¢å¤–çš„çŠ¶æ€ï¼Œæ‰€ä»¥æ˜¾ç„¶æŠŠä»–ä½œä¸ºå‚æ•°ä¼ é€’ç»™ä¸‹ä¸€æ¬¡è°ƒç”¨æ˜¯æœ€å¥½çš„åŠæ³•ã€‚è¿™é‡Œçš„ accumulator å¹¶ä¸ä»…é™äºä¸€ä¸ªå‚æ•°ã€‚åƒä¹‹å‰æåˆ°çš„ fibonacci å‡½æ•°ï¼Œéœ€è¦æŠŠå‰ä¸€æ¬¡çš„ç»“æœä¹Ÿä¼ é€’ç»™ä¸‹ä¸€æ¬¡è°ƒç”¨ï¼Œä¹Ÿå°±å‡ºç°ä¸¤ä¸ªé¢å¤–å‚æ•°çš„æƒ…å†µã€‚</p>
<p><strong>ç¬¬äºŒæ­¥</strong>ï¼Œåœ¨é€’å½’çš„ç»ˆç»“ç‚¹è¿”å› accumulator çš„å€¼ã€‚</p>
<pre><code class="language-js"><span class="hljs-keyword">function</span> <span class="hljs-title">factAcc</span>(n, acc) {
  if (n == 0) {
    <span class="hljs-keyword">return</span> <span class="hljs-type">acc</span>;
  }
  ...
</code></pre>
<p>å‰é¢è¯´äº†ï¼Œæ—¢ç„¶ accumulator ç”¨äºç´¯è®¡è®¡ç®—ç»“æœï¼Œé‚£åˆ°äº†é€’å½’ç»ˆæ­¢çš„æ—¶å€™ï¼Œå°±åº”è¯¥æŠŠç»“æœè¿”å›ã€‚åœ¨ factorial å‡½æ•°çš„ä¾‹å­ä¸­ï¼Œå½“æˆ‘ä»¬é€’å½’åˆ° 0 çš„æ—¶å€™ï¼Œå·²ç»æŠŠå‰é¢è¯¥ç´¯ä¹˜çš„ç»“æœè®¡ç®—è¿›äº† <code>acc</code> é‡Œé¢ã€‚</p>
<p><strong>ç¬¬ä¸‰æ­¥</strong>ï¼Œé€’å½’è°ƒç”¨å½“å‰å‡½æ•°ï¼Œæ›´æ–°å‚æ•°å’Œ accumulator çš„å€¼ã€‚</p>
<pre><code class="language-js"><span class="hljs-keyword">function</span> fact<span class="hljs-constructor">Acc(<span class="hljs-params">n</span>, <span class="hljs-params">acc</span>)</span> {
  <span class="hljs-keyword">if</span> (n<span class="hljs-operator"> == </span><span class="hljs-number">0</span>) {
    return acc;
  }
  return fact<span class="hljs-constructor">Acc(<span class="hljs-params">n</span> - 1, <span class="hljs-params">acc</span> <span class="hljs-operator">*</span> <span class="hljs-params">n</span>)</span>;
}
</code></pre>
<p>è¿™é‡Œæ˜¯ç¨å¾®å›°éš¾çš„ä¸€æ­¥ï¼Œå³å¦‚ä½•æ”¹å†™ä¹‹å‰çš„é€’å½’è°ƒç”¨ç‚¹ã€‚è¿™éœ€è¦çœ‹å¯¹åº”çš„åœºæ™¯æ¥ç¡®å®šå¦‚ä½•è®¡ç®—ç´¯è®¡ç»“æœã€‚åœ¨ factorial çš„ä¾‹å­ä¸­ï¼Œå°±æ˜¯ç®€å•çš„æŠŠæ¯æ¬¡é€’å½’çš„ n ç´¯ä¹˜è¿›æ¥ã€‚è€Œåœ¨å…¶ä»–å¾ˆå¤šåœºåˆï¼Œåˆ™éœ€è¦æ›´è¿›ä¸€æ­¥çš„è®¾è®¡ã€‚å¦‚ fibonacci çš„æ ‘çŠ¶é€’å½’ï¼Œæœ¬è´¨ä¸Šæ˜¯å‰åä¸¤æ¬¡è®¡ç®—ç»“æœçš„åˆå¹¶ï¼Œå¤„ç†èµ·æ¥å°±æ²¡è¿™ä¹ˆæ˜æ˜¾ã€‚</p>
<p><strong>ç¬¬å››æ­¥</strong>ï¼Œå†™ä¸€ä¸ªå‡½æ•° wrap åˆšæ‰çš„å°¾é€’å½’å‡½æ•°ï¼Œåˆå§‹åŒ– accumulatorã€‚</p>
<pre><code class="language-js"><span class="hljs-keyword">function</span> <span class="hljs-title">fact</span>(n) {
  <span class="hljs-keyword">return</span> <span class="hljs-type">factAcc(n,</span> <span class="hljs-number">1</span>);
}
</code></pre>
<h2 id="ä¾‹ï¼šfibonacci-å‡½æ•°">ä¾‹ï¼šfibonacci å‡½æ•°</h2>
<pre><code class="language-js"><span class="hljs-keyword">function</span> <span class="hljs-title">fib</span>(n) {
  if (n == 0 || n == 1) {
    <span class="hljs-keyword">return</span> <span class="hljs-type">1</span>;
  }
  <span class="hljs-keyword">return</span> fib(n - <span class="hljs-number">1</span>) + fib(n - <span class="hljs-number">2</span>);
}
</code></pre>
<p><strong>ç¬¬ä¸€æ­¥</strong>ï¼Œå¼•å…¥ accumulator ä½œä¸ºå‚æ•°ã€‚å› ä¸ºæœ‰ä¸¤æ¬¡é€’å½’è°ƒç”¨ï¼Œè®¾è®¡åˆ°ç»“æœåˆå¹¶ï¼Œå¼•å…¥ä¸¤ä¸ªå‚æ•°ã€‚</p>
<pre><code class="language-js"><span class="hljs-keyword">function</span> fib<span class="hljs-constructor">Acc(<span class="hljs-params">n</span>, <span class="hljs-params">a</span>, <span class="hljs-params">b</span>)</span> {
  ...
</code></pre>
<p><strong>ç¬¬äºŒæ­¥</strong>ï¼Œåœ¨é€’å½’çš„ç»ˆç»“ç‚¹è¿”å› accumulator çš„å€¼ã€‚</p>
<pre><code class="language-js"><span class="hljs-keyword">function</span> <span class="hljs-title">fibAcc</span>(n, a, b) {
  if (n == 0 || n == 1) {
    <span class="hljs-keyword">return</span> <span class="hljs-type">a</span>;
  }
  ...
</code></pre>
<p><strong>ç¬¬ä¸‰æ­¥</strong>ï¼Œé€’å½’è°ƒç”¨å½“å‰å‡½æ•°ï¼Œæ›´æ–°å‚æ•°å’Œ accumulator çš„å€¼ã€‚fibnacci å‡½æ•°çš„å®šä¹‰ï¼Œç¬¬ n æ¬¡ç»“æœæ˜¯å‰ä¸¤æ¬¡ç»“æœï¼ˆå‡è®¾åˆ†åˆ«ä¸º <code>a</code>ã€<code>b</code>ï¼‰çš„å’Œï¼ˆå³ <code>a + b</code>ï¼‰ï¼Œä¸‹ä¸€æ¬¡å†å–åˆ°çš„â€œå‰ä¸¤æ¬¡ç»“æœâ€å°±å˜æˆäº† <code>b</code>ã€ <code>a + b</code>ã€‚</p>
<pre><code class="language-js"><span class="hljs-keyword">function</span> fib<span class="hljs-constructor">Acc(<span class="hljs-params">n</span>, <span class="hljs-params">a</span>, <span class="hljs-params">b</span>)</span> {
  <span class="hljs-keyword">if</span> (n<span class="hljs-operator"> == </span><span class="hljs-number">0</span><span class="hljs-operator"> || </span>n<span class="hljs-operator"> == </span><span class="hljs-number">1</span>) {
    return a;
  }
  return fib<span class="hljs-constructor">Acc(<span class="hljs-params">n</span>-1, <span class="hljs-params">b</span>, <span class="hljs-params">a</span> + <span class="hljs-params">b</span>)</span>;
}
</code></pre>
<p><strong>ç¬¬å››æ­¥</strong>ï¼Œå†™ä¸€ä¸ªå‡½æ•° wrap åˆšæ‰çš„å°¾é€’å½’å‡½æ•°ï¼Œåˆå§‹åŒ– accumulatorã€‚</p>
<pre><code class="language-js"><span class="hljs-keyword">function</span> <span class="hljs-title">fib</span>(n) {
  <span class="hljs-keyword">return</span> <span class="hljs-type">fibAcc(n,</span> <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
}
</code></pre>
<h2 id="ç»ƒä¹ é¢˜">ç»ƒä¹ é¢˜</h2>
<p>å„ä½å¯ä»¥è¯•ç€è‡ªè¡Œæ”¹å†™ä¸€ä¸‹ <code>sum</code>ï¼ˆåˆ—è¡¨æ±‚å’Œï¼‰ã€<code>map</code>ï¼ˆåˆ—è¡¨æ˜ å°„ï¼‰å’Œ <code>fold</code>ï¼ˆåˆ—è¡¨æŠ˜å ï¼‰çš„å®ç°ã€‚ï¼ˆå‰ä¸¤ä¸ªç›¸å¯¹ç®€å•ï¼Œç¬¬ä¸‰ä¸ªéœ€è¦å¤šæ€è€ƒä¸€ä¸‹ï¼‰</p>
<p>å…¶å®šä¹‰åˆ†åˆ«å¦‚ä¸‹ï¼š</p>
<pre><code class="language-js">
<span class="hljs-comment">// sum([a, b, c]) = a + b + c</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sum</span><span class="hljs-params">(xs)</span> </span>{
  <span class="hljs-keyword">if</span> (xs.length == <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
  }
  <span class="hljs-keyword">let</span> [first, ...rest] = xs;
  <span class="hljs-keyword">return</span> first + sum(rest);
}

<span class="hljs-comment">// map([a, b, c], fn) = [fn(a), fn(b), fn(c)]</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">map</span><span class="hljs-params">(xs, fn)</span> </span>{
  <span class="hljs-keyword">if</span> (xs.length == <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> [];
  }
  <span class="hljs-keyword">let</span> [first, ...rest] = xs;
  <span class="hljs-keyword">return</span> [<span class="hljs-function"><span class="hljs-keyword">fn</span><span class="hljs-params">(first)</span>, ...<span class="hljs-title">map</span><span class="hljs-params">(rest, fn)</span>]</span>;
}

<span class="hljs-comment">// fold([a, b, c], fn, z) == fn(a, fn(b, fn(c, zero)))</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fold</span><span class="hljs-params">(xs, fn, zero)</span> </span>{
  <span class="hljs-keyword">if</span> (xs.length == <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> zero;
  }
  <span class="hljs-keyword">let</span> [first, ...rest] = xs;
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">fn</span><span class="hljs-params">(first, fold<span class="hljs-params">(rest, fn, zero)</span>)</span></span>;
}
</code></pre>

      

  </article>
  <!-- <div>
        <h5>See Also</h5>
        <ul>
            <li><a href="/about">About Me</a></li>
        </ul>
    </div> -->
  <span class="field">åˆ›å»ºæ—¶é—´ï¼š2021-02-24</span>
  <span class="field">æœ€è¿‘æ›´æ–°æ—¶é—´ï¼š2021-04-13</span>
  <hr>
  <footer>
    <ul>
      <li><a href="/about">å…³äºæˆ‘</a></li>
      <li><a href="/sitemap.xml">ç«™ç‚¹åœ°å›¾</a></li>
      <li><a href="/rss.xml">RSS</a></li>
      <li>Copyright &copy; KimmyLeo</li>
    </ul>
  </footer>
  <script type="text/javascript">
    document.querySelectorAll(".disabled-link").forEach(el => el.addEventListener("click", (e) => {
      alert("é“¾æ¥é¡µé¢ä¸å­˜åœ¨ï¼");
      e.preventDefault();
    }));
  </script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script
</body>

</html>
